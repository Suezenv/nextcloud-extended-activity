(function(){"use strict";try{if(typeof document<"u"){var t=document.createElement("style");t.appendChild(document.createTextNode(".activity[data-v-48b5564f]{display:flex;flex-direction:column;overflow:hidden;height:100%}.activity__actions[data-v-48b5564f]{display:flex;flex-direction:column;width:100%}.activity__list[data-v-48b5564f]{flex-grow:1;overflow:scroll}.activity__empty-content[data-v-48b5564f]{height:100%}[data-v-48b5564f] .empty-content__icon span{background-size:64px;width:64px;height:64px}")),document.head.appendChild(t)}}catch(e){console.error("vite-plugin-css-injected-by-js",e)}})();
import{l as P}from"./extended_activity-sidebar.mjs";import{c as w,v as N}from"./index-BOfflqaq.chunk.mjs";import{k as b,r as S,x as C,C as E,y as R,c as s,o as e,H as g,E as j,b as o,d as r,h as v,g as m,G as p,l as G,I as u,f as L,n as B}from"./translation-CD_FiYBO-DY1a3JEr.chunk.mjs";import{N as T,b as V,_ as W,A as H}from"./ActivityComponent.vue_vue_type_script_setup_true_lang-DONBVUOa.chunk.mjs";import{N as U,_ as $}from"./_plugin-vue_export-helper-2UGMb1Dm.chunk.mjs";import{g as q,a as z,b as h}from"./api-BMPyswm8.chunk.mjs";import{l as _}from"./logger-C3awdEgA.chunk.mjs";import"./preload-helper-DxB7tAWh.chunk.mjs";import"./_commonjsHelpers-CqkleIqs.chunk.mjs";import"./index-BCo2ioUA.chunk.mjs";import"./public-D_zLRUzB.chunk.mjs";const D=b({__name:"ActivitySidebarPlugin",props:{plugin:{},fileInfo:{}},emits:["reload-activities"],setup(i,{emit:t}){const a=i,n=t,c=S();return C(()=>a.plugin.mount(c.value,{context:E()?.proxy,fileInfo:a.fileInfo,reload:()=>n("reload-activities")})),R(()=>a.plugin.unmount()),(I,y)=>(e(),s("div",{ref_key:"attachTarget",ref:c},null,512))}}),F=b({name:"ActivityTab",components:{ActivityComponent:W,NcEmptyContent:V,NcIconSvgWrapper:T,NcLoadingIcon:U,ActivitySidebarPlugin:D},expose:["update"],data(){return{error:"",loading:!0,fileInfo:null,activities:[],lightningBoltSVG:P,sidebarPlugins:[]}},mounted(){this.sidebarPlugins=h()},methods:{async update(i){this.sidebarPlugins=[];const t=h();t.length>0&&j(()=>{this.sidebarPlugins=t}),this.fileInfo=i,this.resetState(),await this.getActivities()},async getActivities(){try{this.loading=!0;const i=await this.processActivities(await this.loadRealActivities()),t=await z({fileInfo:this.fileInfo});this.activities=[...i,...t].sort((a,n)=>n.timestamp-a.timestamp)}catch(i){this.error=g("activity","Unable to load the activity list"),_.error("Error loading the activity list",{error:i})}finally{this.loading=!1}},resetState(){this.loading=!0,this.error="",this.activities=[]},async loadRealActivities(){try{const{data:i}=await w.get(N("apps/extended_activity/api/v2/activity/filter"),{params:{format:"json",object_type:"files",object_id:this.fileInfo.id}});return i.ocs.data}catch(i){if(i.response!==void 0&&i.response.status===304)return[];throw i}},processActivities(i){i=i.map(a=>new H(a)),_.debug(`Processed ${i.length} activity(ies)`,{activities:i,fileInfo:this.fileInfo});const t=q();return i.filter(a=>!t||t.every(n=>n(a)))},t:g}}),J={key:0,class:"extended_activity__actions"},K={key:3,class:"extended_activity__list"};function M(i,t,a,n,c,I){const y=o("NcIconSvgWrapper"),d=o("NcEmptyContent"),A=o("ActivitySidebarPlugin"),x=o("NcLoadingIcon"),k=o("ActivityComponent");return e(),s("div",{class:B([{"icon-loading":i.loading},"extended_activity"])},[i.error||i.fileInfo===null?(e(),r(d,{key:0,name:i.error},{icon:v(()=>[m(y,{svg:i.lightningBoltSVG},null,8,["svg"])]),_:1},8,["name"])):(e(),s(p,{key:1},[i.sidebarPlugins.length>0?(e(),s("div",J,[(e(!0),s(p,null,u(i.sidebarPlugins,(l,f)=>(e(),r(A,{key:f,plugin:l,"file-info":i.fileInfo,onReloadActivities:t[0]||(t[0]=O=>i.getActivities())},null,8,["plugin","file-info"]))),128))])):G("",!0),i.loading?(e(),r(d,{key:1,class:"extended_activity__empty-content",name:i.t("activity","Loading activities")},{icon:v(()=>[m(x)]),_:1},8,["name"])):i.activities.length===0?(e(),r(d,{key:2,class:"extended_activity__empty-content",name:i.t("activity","No activity yet")},{icon:v(()=>t[2]||(t[2]=[L("span",{class:"icon-activity"},null,-1)])),_:1},8,["name"])):(e(),s("ul",K,[(e(!0),s(p,null,u(i.activities,l=>(e(),r(k,{key:l.id,activity:l,"show-previews":!1,onReload:t[1]||(t[1]=f=>i.getActivities())},null,8,["activity"]))),128))]))],64))],2)}const ri=$(F,[["render",M],["__scopeId","data-v-48b5564f"]]);export{ri as default};
//# sourceMappingURL=ActivityTab-CYWgppTP.chunk.mjs.map
